# Observability Checklist

## Metrics Endpoints

All services expose `/metrics` endpoint on their respective ports:
- Telemetry Service: `http://localhost:7001/metrics`
- Cognitive API: `http://localhost:7002/metrics`
- UI Broker: `http://localhost:7003/metrics`

## Counter Definitions

### Telemetry Layer
```
telemetry_emitted_total{region="<region_name>"}
```
Total telemetry records emitted per region.

### Anomaly Detection
```
anomaly_emitted_total{region="<region_name>", symptom="<symptom_type>"}
```
Total anomaly events emitted by region and symptom type.

### Cognitive Layer
```
diagnoses_total{region="<region_name>", cause="<likely_cause>"}
```
Total diagnoses completed by region and cause.

```
recommendations_total{region="<region_name>", mode="<safe|aggressive>"}
```
Total recommendations generated by region and mode.

```
simulations_total{region="<region_name>"}
```
Total simulations executed by region.

### UI/Broker
```
ui_payloads_total{region="<region_name>"}
```
Total UI payload updates sent to dashboard.

## Example PromQL Queries

### Open Incidents by Region
```promql
sum(anomaly_emitted_total) by (region) 
- sum(diagnoses_total{status="resolved"}) by (region)
```

### Anomaly Rate (5-minute window)
```promql
rate(anomaly_emitted_total[5m])
```

### Diagnosis Success Rate
```promql
sum(diagnoses_total{confidence>0.8}) / sum(diagnoses_total)
```

### Average Simulation Requests per Region
```promql
avg(rate(simulations_total[10m])) by (region)
```

### Top Symptoms by Count
```promql
topk(3, sum(anomaly_emitted_total) by (symptom))
```

## Log Structure

All logs are newline-delimited JSON with ISO timestamps:

```json
{
  "timestamp": "2025-10-31T23:34:15.123Z",
  "level": "INFO|WARN|ERROR",
  "component": "telemetry_generator|anomaly_detector|cognitive_layer|orchestrator|ui_broker",
  "message": "Human-readable message",
  "trace_id": "trace_xxx",
  "event_id": "evt_xxx",
  "additional_fields": {}
}
```

## Grafana Dashboard Panels

1. **Telemetry Rate**: `rate(telemetry_emitted_total[1m])`
2. **Active Incidents**: Open incidents by region
3. **Diagnosis Confidence**: Histogram of confidence scores
4. **MTTR**: Time from anomaly to resolution
5. **Action Distribution**: Pie chart of action types
